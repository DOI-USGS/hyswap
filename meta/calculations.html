

<!doctype html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Calculations Quick-Reference &#8212; hyswap 0.1.dev1+g1826fa6 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=f15d3b81" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/documentation_options.js?v=5d96e694"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing Guidelines" href="contributing.html" />
    <link rel="prev" title="Glossary" href="glossary.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="contributing.html" title="Contributing Guidelines"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="glossary.html" title="Glossary"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">hyswap 0.1.dev1+g1826fa6 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Calculations Quick-Reference</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="calculations-quick-reference">
<h1>Calculations Quick-Reference<a class="headerlink" href="#calculations-quick-reference" title="Link to this heading">¶</a></h1>
<p>A quick-reference guide to the common types of calculations performed within the <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> package is provided below. See the <a class="reference internal" href="glossary.html"><span class="doc">Glossary</span></a> section for definitions of specific terms. Also, refer to the <a class="reference internal" href="../reference/index.html"><span class="doc">API Reference</span></a> section for more detailed documentation on specific functions within <code class="docutils literal notranslate"><span class="pre">hyswap</span></code>.</p>
<section id="assumptions-and-caveats">
<h2>Assumptions and Caveats<a class="headerlink" href="#assumptions-and-caveats" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> package functions assume that provided streamflow data has been quality controlled. No checks on incorrect, missing, or negative values are performed. Users should perform any necessary QA/QC checks on the data prior to using <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> functions. Additionally, <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> does not detect artifacts or shifts in streamflow data that potentially violate statistical methods, such as:
- negative flows associated with tidal-influenced locations or other phenomena
- regulated flows or transitions from regulated to unregulated flows (or vice versa)
- major watershed changes</p>
</section>
<section id="streamflow-percentiles">
<h2>Streamflow Percentiles<a class="headerlink" href="#streamflow-percentiles" title="Link to this heading">¶</a></h2>
<p>Streamflow percentiles are a core calculation of <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> that are used to determine streamflow conditions (e.g., normal, high-flow, low-flow, drought, flood). Percentiles can be computed from daily streamflow (discharge), <em>n</em>-day average streamflow, or runoff. Multiple types of percentiles are used in hydrologic analysis and vary in what subset of observations are used in calculating a given set of percentiles. Percentiles are closely related to exceedance probabilities used to construct flow duration curves (see below). The <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> package provides support for the following types of streamflow percentiles:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Percentile Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Variable (Day of Year)</p></td>
<td><p>Computed using flow observations for that
day from all years of record resulting
in percentile classes/thresholds that
change seasonally and correspond to a
specific day of year. Variable percentiles
are useful for characterizing flow
conditions relative to the typical flow
on a given day of the year. The variable
(day of year) percentile is the standard
percentile that is displayed in USGS
water data services.</p></td>
</tr>
<tr class="row-odd"><td><p>Fixed (All days)</p></td>
<td><p>Computed using all flow observations in
the period of record. Records from all
days of the year are combined resulting
in percentile classes/thresholds that do
not change seasonally. Fixed percentiles
are useful for characterizing flow
conditions relative to non-moving
phenomena such as flood stages or dam
intakes.</p></td>
</tr>
<tr class="row-even"><td><p>Variable Moving Window
(Day of Year)</p></td>
<td><p>Computed using flow observations for that
day plus or minus <em>n</em> number of days
(e.g., 7, 14, or 30) from all years of
record resulting in percentile
classes/thresholds that change seasonally
and correspond to a specific day of year.
Variable moving window percentiles reduce
the fluctuation in percentile classes from
day-to-day, especially for sites with
short observation records. Variable
moving window is useful for
characterizing flow conditions relative to
typical flow expected on a given day of
the year.</p></td>
</tr>
</tbody>
</table>
<p>By default, <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> computes streamflow percentiles using the unbiased Weibull plotting position formula, <span class="math notranslate nohighlight">\(i/(n+1)\)</span>, where <em>i</em> is the rank of an observation and <em>n</em> is the sample size (Weibull, 1939). The Weibull formula has been the standard approach used by hydrologists for generating flow-duration and flood-frequency curves <a class="reference external" href="https://doi.org/10.3133/tm4A3">(Helsel and others, 2020)</a>. Weibull plotting position does not set values to either 0 or 100, recognizing the existence of a non-zero probablity of exceeding the maximum or minimum observed value. For further discussion of plotting positions refer to <a class="reference external" href="https://doi.org/10.3133/tm4A3">(Helsel and others, 2020)</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">hyswap</span></code> uses the <code class="docutils literal notranslate"><span class="pre">numpy.percentile()</span></code> implementation of the Weibull method (Type 6) for calculating percentiles. Additional methods of computing percentiles that exist in the <code class="docutils literal notranslate"><span class="pre">numpy.percentile()</span></code> function can be used in <code class="docutils literal notranslate"><span class="pre">hyswap</span></code>. Users can refer to the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.percentile.html">numpy function documentation</a> for additional details.</p>
<p>Other default settings for percentile calculations are that NA values are dropped, a minimum of 10 years of record length is available for a given day of year, and percentile levels of 0, 5, 10, 25, 50, 75, 90, 95, 100 are calculated.</p>
<p><code class="docutils literal notranslate"><span class="pre">hyswap</span></code> uses the <code class="docutils literal notranslate"><span class="pre">numpy.percentile()</span></code> implementation of the Weibull method (Type 6) for calculating percentiles</p>
<section id="exceedance-probabilities-and-flow-duration-curves">
<h3>Exceedance Probabilities and Flow-Duration Curves<a class="headerlink" href="#exceedance-probabilities-and-flow-duration-curves" title="Link to this heading">¶</a></h3>
<p>In some hydrological studies, particularly those related to floods, a variation of the percentile known as the “percent exceedance” is used. It can be obtained by subtracting the percentile scale value from 100 percent.  For example, a discharge at the 75th percentile is the same as a discharge at the 25th percent exceedance (100-75=25). By default, <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> computes streamflow exceedance probabilities using the unbiased Weibull plotting position formula (Weibull, 1939). Additional methods of computing exceedance probabilities can be used in <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> including linear (R Type 4), Hazen (R Type 5), Gumbel (R Type 7), Reiss (R Type 8), and Blom (R Type 9). Flow-duration curves computed within <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> are cumulative frequency curves where values indicate either (1) the percent of values equal to or less than each discharge value (percentile) OR (2) the percent of values equal to or greater than each discharge value (percent exceedance). The Weibull method of computing exceedance probabilities is used by default for computing flow-duration curves.</p>
</section>
<section id="flow-categorization">
<h3>Flow Categorization<a class="headerlink" href="#flow-categorization" title="Link to this heading">¶</a></h3>
<p>Streamflow observations at a streamgage can be assigned a flow condition category using <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> by use of the <cite>hyswap</cite> <a class="reference internal" href="../reference/index.html#hyswap.utils.categorize_flows" title="hyswap.utils.categorize_flows"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hyswap.utils.categorize_flows</span></code></a> function. Streamflow percentiles or interpolated estimated streamflow percentiles are compared to a categorization schema. Multiple categorization schema are available in <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> with the default being flow categories similar to those displayed on the USGS National Water Dashboard. Categorization schema are applicable to both variable and fixed percentile types. Available schema are described below:</p>
<ul>
<li><p>“NWD” – Categorization schema similar to the USGS National Water Dashboard, <em>default</em>
Categorizes streamflow across all range of possible streamflow magnitudes. Typically used with variable percentiles</p>
<a class="reference internal image-reference" href="../_images/nwd.png"><img alt="Categorization schema of percentile ranges, labels, and color palette similar to the National Water Dashboard." src="../_images/nwd.png" style="width: 800px;" /></a>
</li>
<li><p>“WaterWatch” – Categorization schema similar to the USGS WaterWatch website
Categorizes streamflow across all range of possible streamflow magnitudes. Typically used with variable percentiles</p>
<a class="reference internal image-reference" href="../_images/waterwatch.png"><img alt="Categorization schema of percentile ranges, labels, and color palette similar to USGS WaterWatch." src="../_images/waterwatch.png" style="width: 800px;" /></a>
</li>
<li><p>“NIDIS_Drought” – Categorization schema similar to the NIDIS U.S. Drought Monitor
Categorizes streamflow across only low-flow conditions.</p>
<a class="reference internal image-reference" href="../_images/nidis_drought.png"><img alt="Categorization schema of percentile ranges, labels, and color palette similar to NIDIS U.S. Drought Monitor." src="../_images/nidis_drought.png" style="width: 800px;" /></a>
</li>
<li><p>“WaterWatch_Drought” – Categorization schema similar to the USGS WaterWatch Drought Conditions
Categorizes streamflow across only low-flow conditions. Typically used with variable percentiles</p>
<a class="reference internal image-reference" href="../_images/waterwatch_drought.png"><img alt="Categorization schema of percentile ranges, labels, and color palette similar to USGS WaterWatch Drought Conditions." src="../_images/waterwatch_drought.png" style="width: 800px;" /></a>
</li>
<li><p>“WaterWatch_Flood” – Categorization schema similar to the USGS WaterWatch Flood Conditions
Categorizes streamflow across only high-flow conditions. Typically used with fixed percentiles</p>
<a class="reference internal image-reference" href="../_images/waterwatch_flood.png"><img alt="Categorization schema of percentile ranges, labels, and color palette similar to USGS WaterWatch Flood Conditions." src="../_images/waterwatch_flood.png" style="width: 800px;" /></a>
</li>
<li><p>“WaterWatch_BrownBlue” – Categorization schema similar to the USGS WaterWatch categories but with an alternative color palette
Categorizes streamflow across all range of possible streamflow magnitudes. Typically used with variable percentiles</p>
<a class="reference internal image-reference" href="../_images/waterwatch_brownblue.png"><img alt="Categorization schema of percentile ranges and labels similar to USGS WaterWatch but with a brown-blue color palette." src="../_images/waterwatch_brownblue.png" style="width: 800px;" /></a>
</li>
</ul>
</section>
</section>
<section id="area-based-runoff">
<h2>Area-Based Runoff<a class="headerlink" href="#area-based-runoff" title="Link to this heading">¶</a></h2>
<p>In addition to information on a per-streamgage basis, <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> can generate water information at the regional scale through computation of area-based runoff calculations. Estimates of runoff for a given area (e.g., state or HUC2 region) are generated by combining streamflow data collected at USGS streamgages at the sub-basin HUC8 (8-digit hydrologic unit code or hydrologic cataloging unit) using a weighted average approach. Hydrologic cataloging units and associated 8-digit accounting numbers (HUC8s) are a widely used geographic framework for the conterminous United States (CONUS). Each unit defines a geographic area representing part or all of a surface drainage basin or a combination of drainage basins. Cataloging units subdivide larger accounting units (HUC6s), subregions (HUC4s) and regions (HUC2s) into smaller areas designated by the U.S. Water Resources Council and the USGS’s National Water Data Network. Cataloging units range in size from 24 to 22,808 km<sup>2</sup> with a median value of 3,133 km<sup>2</sup> <cite>(Jones and others, 2022)</cite>.</p>
<p>The calculation of area-based runoff in <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> involves the steps described below and illustrated in an example in Figure 1:</p>
<ol class="arabic simple">
<li><p>Computation of runoff values (flow per unit area) for each streamgage basin by dividing the average daily flow by the delineated drainage area. Drainage areas are an input to the <code class="docutils literal notranslate"><span class="pre">streamflow_to_runoff</span></code> function in <code class="docutils literal notranslate"><span class="pre">hyswap</span></code>.</p></li>
<li><p>Calculation of runoff for each HUC8 unit that is in the area of interest (e.g., state or HUC2 region) using the runoff from multiple streamgages along with associated weighting factors. Weight matrices that contain weighting factors for all HUC8s and streamgages are an input to the <code class="docutils literal notranslate"><span class="pre">calculate_geometric_runoff</span></code> functions in <code class="docutils literal notranslate"><span class="pre">hyswap</span></code> functions and must be created from spatial data layers describing HUC and streamgage drainage area boundaries. An example workflow for creating the weight matrix used in the area-based runoff calculations is described below.</p></li>
<li><p>Aggregation runoff from the individual HUC8s that are within the area of interest (e.g., state or HUC2 region)</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/huc8_runoff_example.gif"><img alt="Map and table that provide an example of the computation of area-based runoff for a given HUC." src="../_images/huc8_runoff_example.gif" style="width: 600px;" /></a>
<p>Figure 1. Example computation for computation of runoff for a selected HUC unit. (The drainage area of basin A is shaded light gray and the drainage area of basin B is shaded pink. Note that drainage basin B is nested within drainage basin A). Figure from <a href="#id1"><span class="problematic" id="id2">`(Brakebill and others, 2011)`_</span></a></p>
<section id="workflow-for-determing-weighting-of-streamgages-for-area-based-runoff-calculations">
<h3>Workflow for Determing Weighting of Streamgages for Area-Based Runoff Calculations<a class="headerlink" href="#workflow-for-determing-weighting-of-streamgages-for-area-based-runoff-calculations" title="Link to this heading">¶</a></h3>
<p>Spatial datasets describing the respective drainage basin boundaries of the streamgages and the boundaries of hydrologic cataloging units must be obtained that cover the all areas of interest (e.g. CONUS). Geospatial boundaries of streamgages can be based on delineated gage drainage areas calculated using NHDPlus Version 1 data <a class="reference external" href="https://water.usgs.gov/lookup/getspatial?streamgagebasins">(U.S. Geological Survey, 2011)</a> or determined via other watershed delineation approaches. HUC8 boundaries are contained within the <a href="#id3"><span class="problematic" id="id4">`USGS Watershed Boundary Dataset (WBD)&lt;https://www.usgs.gov/national-hydrography/watershed-boundary-dataset&gt;`_</span></a>.</p>
<p>Each geospatial streamgage drainage basin boundary is overlain on a geospatial dataset of HUC8s (the polygons outlined in bold black lines in Figure 1 example) to determine the area of intersection within the two datasets. For each overlapping area of HUC8s and streamgage drainage basin boundaries, the fraction of the basin in the HUC8 and the fraction of the HUC8 in the basin are calculated. These fractions are then multiplied by each other to compute a weighting factor for each basin. Weighting factors for each streamgage drainage basin for each HUC8 can then be stored in a single weight matrix.</p>
<p><em>Description of methods for area-based runoff computation is adapted from `USGS WaterWatch &lt;https://pubs.usgs.gov/publication/fs20083031&gt;`</em></p>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<p>Brakebill, J.W., D.M. Wolock, and S.E. Terziotti, 2011. Digital Hydrologic Networks Supporting Applications Related to Spatially Referenced Regression Modeling. Journal of the American Water Resources Association(JAWRA) 47(5):916-932.</p>
<p>Helsel, D.R., Hirsch, R.M., Ryberg, K.R., Archfield, S.A., and Gilroy, E.J., 2020, Statistical methods in water resources: U.S. Geological Survey Techniques and Methods, book 4, chap. A3, 458 p., <a class="reference external" href="https://doi.org/10.3133/tm4a3">doi.org/10.3133/tm4a3</a>. [Supersedes USGS Techniques of Water-Resources Investigations, book 4, chap. A3, version 1.1.]</p>
<p>Jones, K.A., Niknami, L.S., Buto, S.G., and Decker, D., 2022, Federal standards and procedures for the national Watershed Boundary Dataset (WBD) (5 ed.): U.S. Geological Survey Techniques and Methods 11-A3, 54 p., <a class="reference external" href="https://doi.org/10.3133/tm11A3">doi.org/10.3133/tm11A3</a>.</p>
<p>U.S. Geological Survey, 2011. USGS Streamgage NHDPlus Version 1 Basins 2011. Data Series [DS-719] <cite>water.usgs.gov/lookup/getspatial?streamgagebasins &lt;https://water.usgs.gov/lookup/getspatial?streamgagebasins&gt;`_</cite></p>
<p>U.S. Geological Survey, 2023. USGS water data for the Nation: U.S. Geological Survey National Water Information System database, accessed at <cite>doi.org/10.5066/F7P55KJN &lt;http://dx.doi.org/10.5066/F7P55KJN&gt;`_</cite></p>
<p>Weibull, W., 1939. A statistical theory of strength of materials: Ingeniors Vetenskaps Akademien Handlinga, no. 153, 9. 17</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Calculations Quick-Reference</a><ul>
<li><a class="reference internal" href="#assumptions-and-caveats">Assumptions and Caveats</a></li>
<li><a class="reference internal" href="#streamflow-percentiles">Streamflow Percentiles</a><ul>
<li><a class="reference internal" href="#exceedance-probabilities-and-flow-duration-curves">Exceedance Probabilities and Flow-Duration Curves</a></li>
<li><a class="reference internal" href="#flow-categorization">Flow Categorization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#area-based-runoff">Area-Based Runoff</a><ul>
<li><a class="reference internal" href="#workflow-for-determing-weighting-of-streamgages-for-area-based-runoff-calculations">Workflow for Determing Weighting of Streamgages for Area-Based Runoff Calculations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="glossary.html"
                          title="previous chapter">Glossary</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="contributing.html"
                          title="next chapter">Contributing Guidelines</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/meta/calculations.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="contributing.html" title="Contributing Guidelines"
             >next</a> |</li>
        <li class="right" >
          <a href="glossary.html" title="Glossary"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">hyswap 0.1.dev1+g1826fa6 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Calculations Quick-Reference</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>