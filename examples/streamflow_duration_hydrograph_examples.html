

<!doctype html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Streamflow Duration Hydrographs &#8212; hyswap 0.1.dev1+g934b6c5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=f15d3b81" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    
    <script src="../_static/documentation_options.js?v=a7efe5e2"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cumulative Streamflow Hydrographs" href="cumulative_hydrograph_examples.html" />
    <link rel="prev" title="Raster Hydrographs" href="raster_hydrograph_examples.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cumulative_hydrograph_examples.html" title="Cumulative Streamflow Hydrographs"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="raster_hydrograph_examples.html" title="Raster Hydrographs"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">hyswap 0.1.dev1+g934b6c5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Streamflow Duration Hydrographs</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="streamflow-duration-hydrographs">
<h1>Streamflow Duration Hydrographs<a class="headerlink" href="#streamflow-duration-hydrographs" title="Link to this heading">¶</a></h1>
<p>These examples show how a streamflow hydrograph can be constructed by fetching historical streamflow data from NWIS using <cite>dataretrieval</cite>, and then calculating daily percentiles of streamflow for each day of the year.
The resulting hydrographs show the streamflow values for all of 2022 plotted on top of the historical percentiles which are shown as shaded regions.</p>
<section id="calculating-percentiles-using-hyswap">
<h2>Calculating Percentiles Using <cite>hyswap</cite><a class="headerlink" href="#calculating-percentiles-using-hyswap" title="Link to this heading">¶</a></h2>
<p>First, we will fetch streamflow data for a single gage from NWIS using the <cite>dataretrieval</cite> package.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataretrieval</span><span class="o">.</span><span class="n">nwis</span><span class="o">.</span><span class="n">get_dv</span><span class="p">(</span><span class="s2">&quot;03586500&quot;</span><span class="p">,</span>
                                  <span class="n">parameterCd</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
                                  <span class="n">start</span><span class="o">=</span><span class="s2">&quot;1776-01-01&quot;</span><span class="p">,</span>
                                  <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next we will calculate the percentiles for each day of the year based on historic streamflow data using the <a class="reference internal" href="../reference/index.html#hyswap.percentiles.calculate_variable_percentile_thresholds_by_day" title="hyswap.percentiles.calculate_variable_percentile_thresholds_by_day"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hyswap.percentiles.calculate_variable_percentile_thresholds_by_day</span></code></a> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">percentiles_by_day</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">percentiles</span><span class="o">.</span><span class="n">calculate_variable_percentile_thresholds_by_day</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Finally, we will plot the streamflow data for 2022 on top of the historical percentiles.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get year/doy information for the data</span>
<span class="n">df_year</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">define_year_doy_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">clip_leap_day</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># plotting percentiles by day with line shade between</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># filter down to data from 2022</span>
<span class="n">df_2022</span> <span class="o">=</span> <span class="n">df_year</span><span class="p">[</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2022</span><span class="p">]</span>
<span class="c1"># plot data</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">percentiles_by_day</span><span class="p">,</span>
    <span class="n">df_2022</span><span class="p">,</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_doy&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year - Site 03586500&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../_downloads/4801b2f8bedfbe493e4981c2e5b15373/streamflow_duration_hydrograph_examples-3.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/eae4c219d9400f6be81db28a1157fa4c/streamflow_duration_hydrograph_examples-3.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>)</p>
<figure class="align-default">
<img alt="../_images/streamflow_duration_hydrograph_examples-3.png" class="plot-directive" src="../_images/streamflow_duration_hydrograph_examples-3.png" />
</figure>
</section>
<section id="fetching-percentiles-from-the-nwis-statistics-service">
<h2>Fetching Percentiles from the NWIS Statistics Service<a class="headerlink" href="#fetching-percentiles-from-the-nwis-statistics-service" title="Link to this heading">¶</a></h2>
<p>You don’t have to compute the percentiles using <cite>hyswap</cite>.
If you’d rather use the NWIS web service daily percentiles, you can use those values instead.
We provide a convenience utility function to help make this possible, <a class="reference internal" href="../reference/index.html#hyswap.utils.munge_nwis_stats" title="hyswap.utils.munge_nwis_stats"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hyswap.utils.munge_nwis_stats</span></code></a>.
Below is an example of fetching NWIS daily statistics data using the <cite>dataretrieval</cite> package, and then munging and plotting the data with <cite>hyswap</cite>.</p>
<p>First, we will use <cite>dataretrieval</cite> to fetch both the statistics data from NWIS,
as well as streamflow data from the year 2022.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_stats</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataretrieval</span><span class="o">.</span><span class="n">nwis</span><span class="o">.</span><span class="n">get_stats</span><span class="p">(</span>
    <span class="s2">&quot;03586500&quot;</span><span class="p">,</span>
    <span class="n">parameterCd</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
    <span class="n">statReportType</span><span class="o">=</span><span class="s2">&quot;daily&quot;</span>
<span class="p">)</span>

<span class="n">df_flow</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataretrieval</span><span class="o">.</span><span class="n">nwis</span><span class="o">.</span><span class="n">get_dv</span><span class="p">(</span>
    <span class="s2">&quot;03586500&quot;</span><span class="p">,</span>
    <span class="n">parameterCd</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="s2">&quot;2022-01-01&quot;</span><span class="p">,</span>
    <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now that we’ve retrieved our web data, we will apply some <cite>hyswap</cite> functions to make a duration hydrograph plot.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting percentiles by day with line shade between</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># munge the statistics data</span>
<span class="n">df_stats</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">munge_nwis_stats</span><span class="p">(</span><span class="n">df_stats</span><span class="p">)</span>
<span class="c1"># add day of year column to the flow data</span>
<span class="n">df_flow</span><span class="p">[</span><span class="s2">&quot;doy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_flow</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofyear</span>
<span class="c1"># plot the duration hydrograph</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">df_stats</span><span class="p">,</span>
    <span class="n">df_flow</span><span class="p">,</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;doy&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year - Site 03586500&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference download internal" download="" href="../_downloads/256c82dd580093f66bea3660c74fefa1/streamflow_duration_hydrograph_examples-5.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/91cf229ae73aa8aa034179d240ab171d/streamflow_duration_hydrograph_examples-5.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>)</p>
<figure class="align-default">
<img alt="../_images/streamflow_duration_hydrograph_examples-5.png" class="plot-directive" src="../_images/streamflow_duration_hydrograph_examples-5.png" />
</figure>
</section>
<section id="plotting-by-water-year">
<h2>Plotting by Water Year<a class="headerlink" href="#plotting-by-water-year" title="Link to this heading">¶</a></h2>
<p>The examples above show how to plot the percentiles by day of year using the calendar year.
In this example, we will plot the percentiles by day of water year, as water years are commonly by hydrologists.
The only change this requires from above is specifying the type of year we are planning to use when calculating the daily percentile thresholds.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># fetch historic data from NWIS</span>
<span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataretrieval</span><span class="o">.</span><span class="n">nwis</span><span class="o">.</span><span class="n">get_dv</span><span class="p">(</span><span class="s2">&quot;03586500&quot;</span><span class="p">,</span>
                                  <span class="n">parameterCd</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
                                  <span class="n">start</span><span class="o">=</span><span class="s2">&quot;1776-01-01&quot;</span><span class="p">,</span>
                                  <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span><span class="p">)</span>

<span class="c1"># calculate historic daily percentile thresholds for water years</span>
<span class="n">percentiles_by_day</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">percentiles</span><span class="o">.</span><span class="n">calculate_variable_percentile_thresholds_by_day</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="n">year_type</span><span class="o">=</span><span class="s2">&quot;water&quot;</span>
<span class="p">)</span>

<span class="c1"># get year/doy information</span>
<span class="n">df_year</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">define_year_doy_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                                               <span class="n">year_type</span><span class="o">=</span><span class="s1">&#39;water&#39;</span>
                                               <span class="n">clip_leap_day</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting percentiles by day with line shade between</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># filter down to data from 2022</span>
<span class="n">df_2022</span> <span class="o">=</span> <span class="n">df_year</span><span class="p">[</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;index_year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2022</span><span class="p">]</span>
<span class="c1"># plot data</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">percentiles_by_day</span><span class="p">,</span>
    <span class="n">df_2022</span><span class="p">,</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_doy&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;Water Year 2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year - Site 03586500&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="plotting-by-climate-year">
<h2>Plotting by Climate Year<a class="headerlink" href="#plotting-by-climate-year" title="Link to this heading">¶</a></h2>
<p>The examples above show how to plot the percentiles by day of year using the calendar year.
In this example, we will plot the percentiles by day of climate year.
The only change this requires from above is specifying the type of year we are planning to use when calculating the daily percentile thresholds.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># fetch historic data from NWIS</span>
<span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataretrieval</span><span class="o">.</span><span class="n">nwis</span><span class="o">.</span><span class="n">get_dv</span><span class="p">(</span><span class="s2">&quot;03586500&quot;</span><span class="p">,</span>
                                  <span class="n">parameterCd</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
                                  <span class="n">start</span><span class="o">=</span><span class="s2">&quot;1776-01-01&quot;</span><span class="p">,</span>
                                  <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span><span class="p">)</span>

<span class="c1"># calculate historic daily percentile thresholds for water years</span>
<span class="n">percentiles_by_day</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">percentiles</span><span class="o">.</span><span class="n">calculate_variable_percentile_thresholds_by_day</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="n">year_type</span><span class="o">=</span><span class="s2">&quot;climate&quot;</span>
<span class="p">)</span>

<span class="c1"># get year/doy information</span>
<span class="n">df_year</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">define_year_doy_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                                               <span class="n">year_type</span><span class="o">=</span><span class="s1">&#39;climate&#39;</span>
                                               <span class="n">clip_leap_day</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting percentiles by day with line shade between</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># filter down to data from 2022</span>
<span class="n">df_2022</span> <span class="o">=</span> <span class="n">df_year</span><span class="p">[</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;index_year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2022</span><span class="p">]</span>
<span class="c1"># plot data</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">percentiles_by_day</span><span class="p">,</span>
    <span class="n">df_2022</span><span class="p">,</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_doy&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;Climate Year 2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year - Site 03586500&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="plotting-custom-set-of-percentile-thresholds">
<h2>Plotting Custom Set of Percentile Thresholds<a class="headerlink" href="#plotting-custom-set-of-percentile-thresholds" title="Link to this heading">¶</a></h2>
<p>In this example we will calculate and plot a unique set of daily percentile thresholds.
We will also specify the colors to be used for the percentile envelopes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># fetch historic data from NWIS</span>
<span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataretrieval</span><span class="o">.</span><span class="n">nwis</span><span class="o">.</span><span class="n">get_dv</span><span class="p">(</span><span class="s2">&quot;03586500&quot;</span><span class="p">,</span>
                                  <span class="n">parameterCd</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
                                  <span class="n">start</span><span class="o">=</span><span class="s2">&quot;1776-01-01&quot;</span><span class="p">,</span>
                                  <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span><span class="p">)</span>

<span class="c1"># calculate specific historic daily percentile thresholds for water years</span>
<span class="n">percentiles_by_day</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">percentiles</span><span class="o">.</span><span class="n">calculate_variable_percentile_thresholds_by_day</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">year_type</span><span class="o">=</span><span class="s2">&quot;water&quot;</span>
<span class="p">)</span>

<span class="c1"># get year/doy information</span>
<span class="n">df_year</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">define_year_doy_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                                               <span class="n">year_type</span><span class="o">=</span><span class="s1">&#39;water&#39;</span>
                                               <span class="n">clip_leap_day</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting percentiles by day with line shade between</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># filter down to data from 2022</span>
<span class="n">df_2022</span> <span class="o">=</span> <span class="n">df_year</span><span class="p">[</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;index_year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2022</span><span class="p">]</span>
<span class="c1"># plot data</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">percentiles_by_day</span><span class="p">,</span>
    <span class="n">df_year</span><span class="p">,</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_doy&quot;</span><span class="p">,</span>
    <span class="n">pct_list</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;Water Year 2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year - Site 03586500&quot;</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="rolling-averages-for-historic-daily-percentile-calculations">
<h2>Rolling Averages for Historic Daily Percentile Calculations<a class="headerlink" href="#rolling-averages-for-historic-daily-percentile-calculations" title="Link to this heading">¶</a></h2>
<p>In this example, rather than calculating historic daily percentile values based solely on the past values from that day of the year, we will calculate the historic daily percentile values based on rolling averages of the past values around that day.
Under the hood this uses the <code class="xref py py-meth docutils literal notranslate"><span class="pre">pandas.DataFrame.rolling()</span></code> method to calculate the rolling average, with the default parameters.
To show the effect of this, we will plot the historic daily percentile values for the daily (default) rolling average, 7-day rolling average, and the 28-day rolling average.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># fetch historic data from NWIS</span>
<span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataretrieval</span><span class="o">.</span><span class="n">nwis</span><span class="o">.</span><span class="n">get_dv</span><span class="p">(</span><span class="s2">&quot;03586500&quot;</span><span class="p">,</span>
                                    <span class="n">parameterCd</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
                                    <span class="n">start</span><span class="o">=</span><span class="s2">&quot;1776-01-01&quot;</span><span class="p">,</span>
                                    <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span><span class="p">)</span>

<span class="c1"># calculate specific historic daily percentile thresholds for water years</span>
<span class="n">percentiles_by_day</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">percentiles</span><span class="o">.</span><span class="n">calculate_variable_percentile_thresholds_by_day</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="n">year_type</span><span class="o">=</span><span class="s2">&quot;water&quot;</span>
<span class="p">)</span>
<span class="n">percentiles_by_7day</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">percentiles</span><span class="o">.</span><span class="n">calculate_variable_percentile_thresholds_by_day</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;7-day&#39;</span><span class="p">,</span> <span class="n">year_type</span><span class="o">=</span><span class="s2">&quot;water&quot;</span>
<span class="p">)</span>
<span class="n">percentiles_by_28day</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">percentiles</span><span class="o">.</span><span class="n">calculate_variable_percentile_thresholds_by_day</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;28-day&#39;</span><span class="p">,</span> <span class="n">year_type</span><span class="o">=</span><span class="s2">&quot;water&quot;</span>
<span class="p">)</span>

<span class="c1"># get year/doy information</span>
<span class="n">df_year</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">define_year_doy_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                                               <span class="n">year_type</span><span class="o">=</span><span class="s1">&#39;water&#39;</span>
                                               <span class="n">clip_leap_day</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting percentiles by day with line shade between</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># filter down to data from 2022</span>
<span class="n">df_2022</span> <span class="o">=</span> <span class="n">df_year</span><span class="p">[</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;index_year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2022</span><span class="p">]</span>
<span class="c1"># plot daily percentiles</span>
<span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">percentiles_by_day</span><span class="p">,</span>
    <span class="n">df_2022</span><span class="p">,</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_doy&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;Water Year 2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year - Site 03586500&quot;</span><span class="p">,</span>
    <span class="n">xlab</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ylab</span><span class="o">=</span><span class="s2">&quot;1-day Streamflow&quot;</span>
<span class="p">)</span>
<span class="c1"># plot 7-day percentiles</span>
<span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">percentiles_by_7day</span><span class="p">,</span>
    <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">rolling_average</span><span class="p">(</span><span class="n">df_2022</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;7D&quot;</span><span class="p">),</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_doy&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;Water Year 2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year (7-day rolling average) - Site 03586500&quot;</span><span class="p">,</span>
    <span class="n">xlab</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ylab</span><span class="o">=</span><span class="s2">&quot;7-day Streamflow&quot;</span>
<span class="p">)</span>
<span class="c1"># plot 28-day percentiles</span>
<span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">percentiles_by_28day</span><span class="p">,</span>
    <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">rolling_average</span><span class="p">(</span><span class="n">df_2022</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="s2">&quot;28D&quot;</span><span class="p">),</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_doy&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;Water Year 2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year (28-day rolling average) - Site 03586500&quot;</span><span class="p">,</span>
    <span class="n">ylab</span><span class="o">=</span><span class="s2">&quot;28-day Streamflow&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="customizing-fill-areas">
<h2>Customizing Fill Areas<a class="headerlink" href="#customizing-fill-areas" title="Link to this heading">¶</a></h2>
<p>In this example we will customize the fill areas between the percentile thresholds by passing keyword arguments to the <a class="reference internal" href="../reference/index.html#hyswap.plots.plot_duration_hydrograph" title="hyswap.plots.plot_duration_hydrograph"><code class="xref py py-obj docutils literal notranslate"><span class="pre">hyswap.plots.plot_duration_hydrograph</span></code></a> function that are then passed through to the <code class="xref py py-meth docutils literal notranslate"><span class="pre">matplotlib.axes.Axes.fill_between()</span></code> function.
Specifically we will set the <cite>alpha</cite> argument to 1.0 to make the fill areas opaque (the default value is 0.5 for some transparency).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># fetch historic data from NWIS</span>
<span class="n">df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataretrieval</span><span class="o">.</span><span class="n">nwis</span><span class="o">.</span><span class="n">get_dv</span><span class="p">(</span><span class="s2">&quot;03586500&quot;</span><span class="p">,</span>
                                  <span class="n">parameterCd</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
                                  <span class="n">start</span><span class="o">=</span><span class="s2">&quot;1776-01-01&quot;</span><span class="p">,</span>
                                  <span class="n">end</span><span class="o">=</span><span class="s2">&quot;2022-12-31&quot;</span><span class="p">)</span>

<span class="c1"># calculate historic daily percentile thresholds for water years</span>
<span class="n">percentiles_by_day</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">percentiles</span><span class="o">.</span><span class="n">calculate_variable_percentile_thresholds_by_day</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span> <span class="n">year_type</span><span class="o">=</span><span class="s2">&quot;water&quot;</span>
<span class="p">)</span>

<span class="c1"># get year/doy information</span>
<span class="n">df_year</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">define_year_doy_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                                               <span class="n">year_type</span><span class="o">=</span><span class="s1">&#39;water&#39;</span>
                                               <span class="n">clip_leap_day</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting percentiles by day with line shade between</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># filter down to data from 2022</span>
<span class="n">df_2022</span> <span class="o">=</span> <span class="n">df_year</span><span class="p">[</span><span class="n">df_year</span><span class="p">[</span><span class="s1">&#39;index_year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2022</span><span class="p">]</span>
<span class="c1"># plot data</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">hyswap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">plot_duration_hydrograph</span><span class="p">(</span>
    <span class="n">percentiles_by_day</span><span class="p">,</span>
    <span class="n">df_2022</span><span class="p">,</span>
    <span class="s2">&quot;00060_Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;index_doy&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">data_label</span><span class="o">=</span><span class="s2">&quot;Water Year 2022&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles of Streamflow by Day of Year - Site 03586500&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Streamflow Duration Hydrographs</a><ul>
<li><a class="reference internal" href="#calculating-percentiles-using-hyswap">Calculating Percentiles Using <cite>hyswap</cite></a></li>
<li><a class="reference internal" href="#fetching-percentiles-from-the-nwis-statistics-service">Fetching Percentiles from the NWIS Statistics Service</a></li>
<li><a class="reference internal" href="#plotting-by-water-year">Plotting by Water Year</a></li>
<li><a class="reference internal" href="#plotting-by-climate-year">Plotting by Climate Year</a></li>
<li><a class="reference internal" href="#plotting-custom-set-of-percentile-thresholds">Plotting Custom Set of Percentile Thresholds</a></li>
<li><a class="reference internal" href="#rolling-averages-for-historic-daily-percentile-calculations">Rolling Averages for Historic Daily Percentile Calculations</a></li>
<li><a class="reference internal" href="#customizing-fill-areas">Customizing Fill Areas</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="raster_hydrograph_examples.html"
                          title="previous chapter">Raster Hydrographs</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="cumulative_hydrograph_examples.html"
                          title="next chapter">Cumulative Streamflow Hydrographs</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/streamflow_duration_hydrograph_examples.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cumulative_hydrograph_examples.html" title="Cumulative Streamflow Hydrographs"
             >next</a> |</li>
        <li class="right" >
          <a href="raster_hydrograph_examples.html" title="Raster Hydrographs"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">hyswap 0.1.dev1+g934b6c5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Streamflow Duration Hydrographs</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.2.
    </div>
  </body>
</html>